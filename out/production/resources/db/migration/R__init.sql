-- 业务表：
create table if not exists `message` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `message_id` bigint(20) NOT NULL COMMENT '消息id',
  `out_message_id` bigint(20) NOT NULL DEFAULT '0' COMMENT '第三方消息id',
  `guid` varchar(50) NOT NULL COMMENT '全局唯一id',
  `session_root_id` bigint(20) NOT NULL COMMENT '咨询根Id',
  `session_id` bigint(20) NOT NULL COMMENT '会话id',
  `consult_channel` bigint(20) NOT NULL COMMENT '咨询渠道',
  `sender_id` bigint(20) NOT NULL COMMENT '发送者id',
  `sender_role` tinyint(4) NOT NULL COMMENT '发送者角色',
  `sender` varchar(30) NOT NULL COMMENT '发送者',
  `message_source` tinyint(4) NOT NULL COMMENT '消息来源',
  `message_type` tinyint(4) NOT NULL COMMENT '消息类型',
  `content` varchar(10000) NOT NULL DEFAULT '' COMMENT '消息内容',
  `status` tinyint(4) NOT NULL COMMENT '消息状态',
  `sender_visible` tinyint(1) NOT NULL DEFAULT '1' COMMENT '发送者可见',
  `visible_roles` int(11) NOT NULL DEFAULT '1' COMMENT '接收者可见性',
  `receiver_visible_roles` varchar(20) NOT NULL DEFAULT '' COMMENT '哪些角色的接收者可见',
  `extra` varchar(2000) NOT NULL DEFAULT '' COMMENT '附加消息',
  `patient_id_consult_channel_consult_object` varchar(60) DEFAULT NULL COMMENT '唯一键',
  `created` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_guid` (`guid`),
  UNIQUE KEY `unq_message_id_consult_channel` (`message_id`,`consult_channel`),
  KEY `idx_session_root_id` (`session_root_id`),
  KEY `idx_session_id` (`session_id`),
  KEY `idx_sender_id` (`sender_id`),
  KEY `idx_sender` (`sender`),
  KEY `idx_message_source` (`message_source`),
  KEY `idx_message_type` (`message_type`),
  KEY `idx_created` (`created`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息';